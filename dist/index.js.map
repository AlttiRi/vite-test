{"version":3,"file":"index.js","sources":["source-maps:///components/Tag.vue","source-maps:///components/InputTag.vue","source-maps:///components/TagsLine.vue","source-maps:///components/Row.vue","source-maps:///components/TextArea.vue","source-maps:///components/Main.vue","source-maps:///App.vue","source-maps:///store/textarea.js","source-maps:///store.js","source-maps:///index.js"],"sourcesContent":["<template>\n<span class=\"tag\">\n  <span class=\"content\"\n      :href=\"`#` + text\"\n      @contextmenu.prevent=\"onContextMenu\"\n      contenteditable=\"false\"\n  >{{text}}</span>\n</span>\n</template>\n\n<script>\n\nexport default {\n  props:[\"text\", \"index\"],\n  emits: [\"delete-tag\"],\n  name: \"Tag\",\n  methods: {\n    onContextMenu() {\n      console.log(\"onContextMenu\");\n      this.$emit(\"delete-tag\", this.index);\n    },\n  }\n}\n</script>\n\n<style scoped>\n\n</style>","<template>\n<span class=\"tag input-tag\">\n    <span class=\"content\"\n          ref=\"input\"\n          contenteditable=\"true\"\n          data-placeholder=\"+\"\n\n          @keydown.space.shift.prevent=\"$event.stopImmediatePropagation(), onSpaceShift($event)\"\n          @keydown.space.prevent=\"onSubmitNewTag\"\n          @keydown.enter.prevent=\"onSubmitNewTag\"\n          @keydown.backspace.ctrl=\"$event.stopImmediatePropagation(), onBackspaceCtrl($event)\"\n          @keydown.backspace=\"onBackspace\"\n\n          @input=\"onInput\"\n\n    ></span>\n</span>\n</template>\n\n<script>\nexport default {\n  name: \"InputTagNew\",\n  props: [\"modelValue\"],\n  emits: [\"update:modelValue\", \"submit-new-tag\", \"backspace\", \"backspace-ctrl\"],\n  mounted() {\n    this.$refs.input.innerText = this.modelValue;\n  },\n\n  methods: {\n    onInput(event) {\n      const inputText = event.target.innerText;\n      const elem = this.$refs.input;\n\n      let hText = inputText\n          .replaceAll(/[\\s\\n]+/g, \" \")\n          .trim();\n      const parts = hText.split(\" \");\n      if (parts.length > 1) {\n        parts\n            .forEach(part => {\n              part = replaceUnderScore(part, true);\n              this.$emit(\"submit-new-tag\", part);\n            });\n        elem.innerText = \"\";\n        return;\n      }\n\n      function replaceUnderScore(hText, replaceOnly = false) {\n        function _replaceUnderScore() {\n          hText = hText.replaceAll(\"__\", \"_\");\n          if (replaceOnly) {\n            return;\n          }\n\n          const {anchorOffset} = window.getSelection();\n          elem.innerText = hText;\n\n          let offset = anchorOffset - 1; // do not move the caret\n          if (hText.charAt(anchorOffset + 1) === \"_\" || hText.length === anchorOffset) {\n            offset = offset + 1;\n          }\n\n          moveCursor(offset);\n        }\n        // if after replacement creates a new \"__\". For example: \"ab_c_de\" and you replace \"c\" with \"_\".\n        while (hText.includes(\"__\")) {\n          _replaceUnderScore();\n        }\n        return hText;\n      }\n\n      hText = replaceUnderScore(hText);\n      this.$emit(\"update:modelValue\", hText);\n    },\n    onSpaceShift() {\n      // pasteInCursorPosition(); // todo?\n      document.execCommand(\"insertText\", false, \"_\");\n      console.log(\"onSpaceShift\");\n    },\n    onSubmitNewTag() {\n      console.log(\"onSubmitNewTag\");\n      const elem = this.$refs.input;\n      if (elem.innerText) {\n        this.$emit(\"submit-new-tag\", elem.innerText);\n      }\n    },\n    onBackspace(event) {\n      console.log(\"onBackspace\");\n      if (!event.target.innerText) {\n        event.preventDefault();\n        this.$emit(\"backspace\");\n      }\n    },\n    onBackspaceCtrl(event) {\n      console.log(\"onBackspaceCtrl\");\n      if (!event.target.innerText) {\n        this.$emit(\"backspace-ctrl\");\n      }\n    },\n  },\n  watch: {\n    async modelValue(newValue, oldValue) {\n      const elem = this.$refs.input;\n      if (elem.innerText !== newValue && newValue !== undefined) {\n        elem.innerText = newValue;\n        moveCursor(newValue.length);\n      }\n    }\n  }\n};\n\nfunction moveCursor(offset = 0, selection = window.getSelection()) {\n  if (!offset) {\n    return;\n  }\n  const range = new Range();\n  const textNode = selection.anchorNode.childNodes[0] ?? selection.anchorNode;\n\n  if (!textNode) {\n    console.log(\"!textNode\");\n    return;\n  }\n\n  let _offset = selection.anchorOffset + offset;\n  _offset = _offset < 0 ? 0 : _offset;\n\n  range.setStart(textNode, _offset);\n  range.collapse(true);\n  selection.removeAllRanges();\n  selection.addRange(range);\n}\n\n\n\nfunction setCursorToEnd(elem) {\n  const range = new Range();\n\n  console.log(window.getSelection().anchorNode === elem);\n\n  const textNode = elem.childNodes[0];\n  if (!textNode) { return; }\n\n  range.setStart(textNode, elem.innerText.length);\n  range.collapse(true);\n  const selection = window.getSelection();\n\n  selection.removeAllRanges();\n  selection.addRange(range);\n  console.log(\"setCursorToEnd\");\n}\n\n\n\n</script>\n\n<style scoped>\n.tag {\n  flex-grow: 2;\n  min-width: 48px;\n}\n.content {\n  width: 100%;\n}\n\n[contenteditable=true]:not(:focus):empty:before {\n  content: attr(data-placeholder);\n  pointer-events: none;\n  display: inline-block;\n  color: darkgray;\n}\n[contenteditable=true]:focus:before {\n  content: \"\";\n}\n</style>","<template>\n  <div class=\"tags-line\">\n    <Tag v-for=\"(tag, index) of tags\"\n         :text=\"tag\"\n         :index=\"index\"\n         @delete-tag=\"onDeleteTag\"\n    />\n    <InputTag\n        @submit-new-tag=\"onSubmitNewTag\"\n        @backspace=\"onBackspace\"\n        @backspace-ctrl=\"onBackspaceCtrl\"\n        v-model=\"inputTagText\"\n    />\n  </div>\n</template>\n\n<script>\nimport Tag from \"./Tag.vue\";\nimport InputTag from \"./InputTag.vue\";\n\nexport default {\n  props: [\"tags\", \"initInputTagText\"],\n  name: \"TagsLine\",\n  components: {Tag, InputTag},\n  data() {\n    return {\n      inputTagText: this.initInputTagText || \"\",\n    }\n  },\n  methods: {\n    onSubmitNewTag(value) {\n      this.tags.push(value);\n      this.inputTagText = \"\";\n    },\n    onBackspace() {\n      this.inputTagText = this.tags.pop();\n    },\n    onBackspaceCtrl() {\n      this.tags.pop();\n    },\n    onDeleteTag(index) {\n      this.tags.splice(index, 1);\n    }\n  },\n}\n\n\n</script>\n\n<style scoped>\n\n::v-deep(.tag) {\n  display: flex;\n}\n\n::v-deep([contenteditable]) {\n  border-bottom: 1px transparent inset;\n  border-top: 1px transparent inset;\n}\n\n::v-deep(.tag:not(.input-tag)) {\n  padding: 2px 6px;\n  border: gray 1px solid;\n  border-radius: 2px;\n  margin: 1px;\n  background-image: linear-gradient(to top, rgba(0,0,0,0.1), rgba(255,255,255,0.55));\n  box-shadow: 0 0 6px rgba(0, 0, 0, 0.05);\n}\n::v-deep(.input-tag) {\n  border: 4px transparent solid;\n  padding-left: 2px;\n  margin-left: 2px;\n}\n::v-deep(.input-tag [contenteditable]:focus) {\n  border-bottom: 1px grey solid;\n}\n::v-deep([contenteditable]) {\n  outline: 0 solid transparent;\n}\n\n\n\n.tags-line {\n  display: flex;\n  flex-wrap: wrap;\n  max-width: 480px;\n  min-width: 320px;\n}\n</style>","<template>\n  <div class=\"row\">\n    <i>{{index}}</i> â€” <b>{{content}}</b>\n    <TagsLine :tags=\"tags\"/>\n  </div>\n</template>\n\n<script>\nimport TagsLine from \"./TagsLine.vue\";\nexport default {\n  name: \"Row\",\n  components: {TagsLine},\n  props: {\n    content: String,\n    index: Number\n  },\n  data() {\n    return {\n      tags: [\"demo\", \"site\"]\n    }\n  }\n}\n</script>\n\n<style scoped>\n.row {\n  margin-top: 8px;\n}\n</style>","<template lang=\"pug\">\ndiv.text-area-component\n  label\n    textarea(placeholder=\"Type a text here\" v-model=\"text\")\n</template>\n\n<script>\nimport {mapMutations, mapState} from \"vuex\";\n\nexport default {\n  name: \"TextArea\",\n  computed: {\n    ...mapState(\"textarea\", {\n      _text: state => state.textarea,\n    }),\n    text: {\n      get() {\n        return this._text;\n      },\n      set(value) {\n        this.setText(value);\n      }\n    }\n  },\n  methods: {\n    ...mapMutations(\"textarea\", [\"setText\"])\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.text-area-component {\n  border: solid 1px var(--textarea-wrapper-border);\n  box-sizing: border-box;\n  width: 100%;\n  textarea {\n    width: 100%;\n    box-sizing: border-box;\n    height: calc(100% - 1px); // firefox bug\n    border: 0;\n    outline: none;\n    padding: 5px;\n    font-size: 17px;\n    &:focus::placeholder {\n      opacity: 0;\n      transition: opacity 0.25s ease;\n    }\n  }\n}\n</style>","<template>\n  <div class=\"container\">\n\n    <TagsLine :tags=\"demoTags\" :initInputTagText=\"`new_tag`\"/>\n\n    <hr>\n\n    <div class=\"textarea-wrapper\">\n      <TextArea/>\n    </div>\n\n    <div v-for=\"(line, index) of linesComputed\">\n      <Row :content=\"line\" :index=\"index\"/>\n    </div>\n\n  </div>\n</template>\n\n<script>\nimport {mapState} from \"vuex\";\nimport Row from \"./Row.vue\";\nimport TagsLine from \"./TagsLine.vue\";\nimport TextArea from \"./TextArea.vue\";\n\nexport default {\n  name: \"Main\",\n  data() {\n    return {\n      demoTags: [\"tag\"]\n    }\n  },\n  components: {Row, TextArea, TagsLine},\n  computed: {\n    ...mapState(\"textarea\", {\n      textarea: state => state.textarea,\n    }),\n    linesComputed() {\n      const lines = this.textarea.split(\"\\n\");\n      return lines.filter(line => line.trim());\n    }\n  }\n}\n</script>\n\n<style scoped lang=\"scss\">\n.container {\n  min-width: 280px;\n  .textarea-wrapper {\n    min-height: 120px;\n    display: grid;\n  }\n}\n</style>","<template>\n  <Main/>\n</template>\n\n<script>\nimport Main from \"./components/Main.vue\";\n\nexport default {\n  components: {Main}\n}\n</script>\n\n<style>\nhtml, body {\n  min-height: 100vh;\n  margin: 0;\n}\nbody {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n}\n#app {\n  font-family: Avenir, Helvetica, Arial, sans-serif;\n}\n:root {\n  --textarea-wrapper-border: rgba(0, 0, 0, 0.6);\n}\n* {\n  box-sizing: border-box;\n}\n</style>","const state = () => ({\n    /** @type {String} */\n    textarea: // \"\"\n        [\n        \"*.example.com\",\n        \"*.example-2.com\",\n        // \"*.example.example.com\",\n        // \"*.example.com\",\n    ].join(\"\\n\"), // todo remove later\n});\n\nconst mutations = {\n    setText(state, text) {\n        state.textarea = text;\n    },\n    clearText(state) {\n        state.textarea = \"\";\n    }\n};\n\nexport default {\n    namespaced: true,\n    state,\n    mutations\n}","import {createStore} from \"vuex\";\nimport textarea from \"./store/textarea.js\";\n\nconst store = createStore({\n    modules: {\n        textarea\n    },\n    plugins: [logMutation]\n});\n\nfunction logMutation(store) {\n    store.subscribe((mutation/*, state*/) => {\n        console.log(mutation);\n    });\n}\n\nexport default store;","import {createApp} from \"vue\";\nimport App from \"./App.vue\";\n\nimport store from \"./store.js\";\n\n\ncreateApp(App)\n    .use(store)\n    .mount(\"#app\");\n"],"names":["props","emits","name","methods","[object Object]","log","$emit","this","index","class","href","onContextmenu","_cache","$refs","input","innerText","modelValue","event","inputText","target","elem","hText","replaceAll","trim","parts","split","length","forEach","replaceUnderScore","part","hText2","replaceOnly","anchorOffset","window","getSelection","offset","charAt","includes","execCommand","preventDefault","watch","newValue","oldValue","selection","range","Range","textNode","anchorNode","childNodes","_offset","setStart","collapse","removeAllRanges","addRange","ref","contenteditable","data-placeholder","$options","components","Tag","InputTag","inputTagText","initInputTagText","value","tags","push","pop","splice","_openBlock","text","onSubmitNewTag","onBackspace","TagsLine","content","String","Number","_hoisted_2","_createVNode","computed","mapState","_text","state2","textarea","setText","mapMutations","demoTags","Row","TextArea","lines","filter","line","Main","state","join","mutations","namespaced","store","createStore","modules","plugins","logMutation","store2","subscribe","mutation","App","use","mount"],"mappings":"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"}